<html>
<head id="head">
<script src="get_data.js"></script>
<script src="mvc.js"></script>
<script src="uri.js"></script>
<script>

var context  = {
	data : 'posts.json',
	view : 'posts.view.js',
	id   : 'main'
};

var context2 = {
	// Check the compilation of this context. it has a redutor for 
	// selecting the right object to show

	data : 'posts.json' ,
	view : 'post.view.js',
	id   : 'post'
};

var context_defered = {
	// This is a list of ids
	data : 'users/users.defered.json',
	
	// this is the skeleton grid, generated syncronously
	view : 'users/users.defered.view.js',

	// This is the root for the defered data. It's assumed
	// that datafiles have the name: defere_root + object_id + '.json'
	defered_root : 'users/',
	
	// this is the view for formatting incoming data
	arrived_view : 'users/users.arrived.view.js',
	
	id : 'users'
};

window.onload = function(){
	
/*
	var dec = decompose(document.URL);

	// Compile view for a post
	if(dec.pars){		
		context2.redutor = {
			init : null,
			redutor : function(res, item){
							if(item.id == dec.pars.post_id){ 
								return item; 
							} 
							return res; 
						}
		};
		compile(context2);
		return;
	}
*/
	// Compile view for listing posts
	//compile(context);
	
	compile(context_defered);
}

window.onpopstate = function(event){
	console.log('onpopstate');
	if(event.state){
		console.log('clean compile ...');
		cleanCompile(event.state);	
	}
}

</script>
</head>
<body id="body">
</body>
</html>